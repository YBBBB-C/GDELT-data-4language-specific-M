-- Chinese anchor ,select chinese news which has other three lang translation content 
WITH chinese_docs AS (
  -- extract Chinese orig event news, 每事件取最早的一条中文提及
  SELECT 
    GLOBALEVENTID,
    ARRAY_AGG(MentionIdentifier ORDER BY MentionTimeDate ASC LIMIT 1)[OFFSET(0)] AS DocumentIdentifier,
    ARRAY_AGG(MentionTimeDate ORDER BY MentionTimeDate ASC LIMIT 1)[OFFSET(0)] AS MentionTimeDate
  FROM `gdelt-bq.gdeltv2.eventmentions_partitioned`
  WHERE MentionDocTranslationInfo LIKE 'srclc:zho%'  -- source lang is chinese:contentReference[oaicite:3]{index=3}
    AND MentionTimeDate >= 20220101000000 AND MentionTimeDate < 20250101000000
  GROUP BY GLOBALEVENTID
),
english_docs AS (
  -- extract En orig event news
  SELECT 
    GLOBALEVENTID,
    ARRAY_AGG(MentionIdentifier ORDER BY MentionTimeDate ASC LIMIT 1)[OFFSET(0)] AS DocumentIdentifier
  FROM `gdelt-bq.gdeltv2.eventmentions_partitioned`
  WHERE (MentionDocTranslationInfo = '' OR MentionDocTranslationInfo IS NULL)  -- 原文为英语（翻译信息为空）
    AND MentionTimeDate >= 20220101000000 AND MentionTimeDate < 20250101000000
  GROUP BY GLOBALEVENTID
),
spanish_docs AS (
  -- extract Spanish orig event news，每事件取最早的一条西班牙语提及
  SELECT 
    GLOBALEVENTID,
    ARRAY_AGG(MentionIdentifier ORDER BY MentionTimeDate ASC LIMIT 1)[OFFSET(0)] AS DocumentIdentifier
  FROM `gdelt-bq.gdeltv2.eventmentions_partitioned`
  WHERE MentionDocTranslationInfo LIKE 'srclc:spa%'  -- 原文为西班牙语:contentReference[oaicite:4]{index=4}
    AND MentionTimeDate >= 20220101000000 AND MentionTimeDate < 20250101000000
  GROUP BY GLOBALEVENTID
),
arabic_docs AS (
  -- extract Arab orig event news，每事件取最早的一条阿拉伯语提及
  SELECT 
    GLOBALEVENTID,
    ARRAY_AGG(MentionIdentifier ORDER BY MentionTimeDate ASC LIMIT 1)[OFFSET(0)] AS DocumentIdentifier
  FROM `gdelt-bq.gdeltv2.eventmentions_partitioned`
  WHERE MentionDocTranslationInfo LIKE 'srclc:ara%'  -- 原文为阿拉伯语:contentReference[oaicite:5]{index=5}
    AND MentionTimeDate >= 20220101000000 AND MentionTimeDate < 20250101000000
  GROUP BY GLOBALEVENTID
)
SELECT
  zh.DocumentIdentifier AS DocumentIdentifier,   -- Chinese news URL
  gkg.V2Themes,                                  
  gkg.V2Tone,                                    
  gkg.GCAM,                                      -- decided not to use but will keep
  zh.GLOBALEVENTID,
  CONCAT(SUBSTR(CAST(zh.MentionTimeDate AS STRING), 1, 4), '-',
         SUBSTR(CAST(zh.MentionTimeDate AS STRING), 5, 2), '-',
         SUBSTR(CAST(zh.MentionTimeDate AS STRING), 7, 2)) AS ts,  -- dateformat（YYYY-MM-DD）
  'zh' AS lang,
  'zh' AS src_lang,
  en.DocumentIdentifier AS url_en,   -- same event but en, URL
  es.DocumentIdentifier AS url_es,   -- same event but es, URL
  ar.DocumentIdentifier AS url_ar    -- same event but ar, URL
FROM chinese_docs zh
JOIN english_docs en  ON zh.GLOBALEVENTID = en.GLOBALEVENTID
JOIN spanish_docs es  ON zh.GLOBALEVENTID = es.GLOBALEVENTID
JOIN arabic_docs ar   ON zh.GLOBALEVENTID = ar.GLOBALEVENTID
JOIN `gdelt-bq.gdeltv2.gkg_partitioned` gkg 
     ON zh.DocumentIdentifier = gkg.DocumentIdentifier  -- connect GKG to get theme and emotion:contentReference[oaicite:6]{index=6}
WHERE (
  gkg.V2Themes LIKE '%FINANCE%'  OR   
  gkg.V2Themes LIKE '%ECONOM%'   OR   
  gkg.V2Themes LIKE '%BUSINESS%' OR   
  gkg.V2Themes LIKE '%MARKET%'       
)
LIMIT 8000;
